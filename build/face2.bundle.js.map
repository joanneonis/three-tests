{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./experiments/face/v2/main.js"],"names":["vid","document","getElementById","vid_width","width","vid_height","height","overlay","overlayCC","getContext","enablestart","startbutton","value","disabled","adjustVideoProportions","proportion","videoWidth","videoHeight","Math","round","gumSuccess","stream","srcObject","src","window","URL","createObjectURL","onloadedmetadata","play","onresize","trackingStarted","ctrack","stop","reset","start","gumFail","alert","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","webkitURL","msURL","mozURL","mediaDevices","video","then","addEventListener","pModel","shapeModel","nonRegularizedVectors","push","clm","tracker","useWebGL","init","startVideo","drawLoop","requestAnimFrame","clearRect","getCurrentPosition","draw","cp","getCurrentParameters","er","ec","meanPredict","updateData","i","length","style","visibility","emotionModel","emotionClassifier","emotionData","getBlank","margin","top","right","bottom","left","barWidth","formatPercent","d3","format","x","scale","linear","domain","getEmotions","range","y","svg","select","append","attr","selectAll","data","enter","datum","index","text","emotion","rects","texts","toFixed","exit","remove","stats","Stats","domElement","position","appendChild","event","update"],"mappings":"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","file":"face2.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./experiments/face/v2/main.js\");\n","var vid = document.getElementById('videoel');\nvar vid_width = vid.width;\nvar vid_height = vid.height;\nvar overlay = document.getElementById('overlay');\nvar overlayCC = overlay.getContext('2d');\n\n/********** check and set up video/webcam **********/\nfunction enablestart() {\n\tvar startbutton = document.getElementById('startbutton');\n\tstartbutton.value = \"start\";\n\tstartbutton.disabled = null;\n}\n\nfunction adjustVideoProportions() {\n\t// resize overlay and video if proportions are different\n\t// keep same height, just change width\n\tvar proportion = vid.videoWidth / vid.videoHeight;\n\tvid_width = Math.round(vid_height * proportion);\n\tvid.width = vid_width;\n\toverlay.width = vid_width;\n}\n\nfunction gumSuccess(stream) {\n\t// add camera stream if getUserMedia succeeded\n\tif (\"srcObject\" in vid) {\n\t\tvid.srcObject = stream;\n\t} else {\n\t\tvid.src = (window.URL && window.URL.createObjectURL(stream));\n\t}\n\tvid.onloadedmetadata = function () {\n\t\tadjustVideoProportions();\n\t\tvid.play();\n\t}\n\tvid.onresize = function () {\n\t\tadjustVideoProportions();\n\t\tif (trackingStarted) {\n\t\t\tctrack.stop();\n\t\t\tctrack.reset();\n\t\t\tctrack.start(vid);\n\t\t}\n\t}\n}\n\nfunction gumFail() {\n\talert(\"There was some problem trying to fetch video from your webcam. If you have a webcam, please make sure to accept when the browser asks for access to your webcam.\");\n}\n\nnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\nwindow.URL = window.URL || window.webkitURL || window.msURL || window.mozURL;\n\n// check for camerasupport\nif (navigator.mediaDevices) {\n\tnavigator.mediaDevices.getUserMedia({\n\t\tvideo: true\n\t}).then(gumSuccess).catch(gumFail);\n} else if (navigator.getUserMedia) {\n\tnavigator.getUserMedia({\n\t\tvideo: true\n\t}, gumSuccess, gumFail);\n} else {\n\talert(\"This demo depends on getUserMedia, which your browser does not seem to support. :(\");\n}\n\nvid.addEventListener('canplay', enablestart, false);\n\n/*********** setup of emotion detection *************/\n// set eigenvector 9 and 11 to not be regularized. This is to better detect motion of the eyebrows\npModel.shapeModel.nonRegularizedVectors.push(9);\npModel.shapeModel.nonRegularizedVectors.push(11);\nvar ctrack = new clm.tracker({\n\tuseWebGL: true\n});\nctrack.init(pModel);\nvar trackingStarted = false;\n\n\ndocument.getElementById('startbutton').addEventListener('click', function () {\n\tstartVideo();\n});\n\nfunction startVideo() {\n\t// start video\n\tvid.play();\n\t// start tracking\n\tctrack.start(vid);\n\ttrackingStarted = true;\n\t// start loop to draw face\n\tdrawLoop();\n}\n\nfunction drawLoop() {\n\trequestAnimFrame(drawLoop);\n\toverlayCC.clearRect(0, 0, vid_width, vid_height);\n\t//psrElement.innerHTML = \"score :\" + ctrack.getScore().toFixed(4);\n\tif (ctrack.getCurrentPosition()) {\n\t\tctrack.draw(overlay);\n\t}\n\tvar cp = ctrack.getCurrentParameters();\n\tvar er = ec.meanPredict(cp);\n\tif (er) {\n\t\tupdateData(er);\n\t\tfor (var i = 0; i < er.length; i++) {\n\t\t\tif (er[i].value > 0.4) {\n\t\t\t\tdocument.getElementById('icon' + (i + 1)).style.visibility = 'visible';\n\t\t\t} else {\n\t\t\t\tdocument.getElementById('icon' + (i + 1)).style.visibility = 'hidden';\n\t\t\t}\n\t\t}\n\t}\n}\n\ndelete emotionModel['disgusted'];\ndelete emotionModel['fear'];\n\nvar ec = new emotionClassifier();\n\nec.init(emotionModel);\n\nvar emotionData = ec.getBlank();\n\n/************ d3 code for barchart *****************/\nvar margin = {\n\t\ttop: 20,\n\t\tright: 20,\n\t\tbottom: 10,\n\t\tleft: 40\n\t},\n\twidth = 400 - margin.left - margin.right,\n\theight = 100 - margin.top - margin.bottom;\nvar barWidth = 30;\nvar formatPercent = d3.format(\".0%\");\nvar x = d3.scale.linear()\n\t.domain([0, ec.getEmotions().length]).range([margin.left, width + margin.left]);\nvar y = d3.scale.linear()\n\t.domain([0, 1]).range([0, height]);\nvar svg = d3.select(\"#emotion_chart\").append(\"svg\")\n\t.attr(\"width\", width + margin.left + margin.right)\n\t.attr(\"height\", height + margin.top + margin.bottom)\nsvg.selectAll(\"rect\").\ndata(emotionData).\nenter().\nappend(\"svg:rect\").\nattr(\"x\", function (datum, index) {\n\treturn x(index);\n}).\nattr(\"y\", function (datum) {\n\treturn height - y(datum.value);\n}).\nattr(\"height\", function (datum) {\n\treturn y(datum.value);\n}).\nattr(\"width\", barWidth).\nattr(\"fill\", \"#2d578b\");\nsvg.selectAll(\"text.labels\").\ndata(emotionData).\nenter().\nappend(\"svg:text\").\nattr(\"x\", function (datum, index) {\n\treturn x(index) + barWidth;\n}).\nattr(\"y\", function (datum) {\n\treturn height - y(datum.value);\n}).\nattr(\"dx\", -barWidth / 2).\nattr(\"dy\", \"1.2em\").\nattr(\"text-anchor\", \"middle\").\ntext(function (datum) {\n\treturn datum.value;\n}).\nattr(\"fill\", \"white\").\nattr(\"class\", \"labels\");\nsvg.selectAll(\"text.yAxis\").\ndata(emotionData).\nenter().append(\"svg:text\").\nattr(\"x\", function (datum, index) {\n\treturn x(index) + barWidth;\n}).\nattr(\"y\", height).\nattr(\"dx\", -barWidth / 2).\nattr(\"text-anchor\", \"middle\").\nattr(\"style\", \"font-size: 12\").\ntext(function (datum) {\n\treturn datum.emotion;\n}).\nattr(\"transform\", \"translate(0, 18)\").\nattr(\"class\", \"yAxis\");\n\nfunction updateData(data) {\n\t// update\n\tvar rects = svg.selectAll(\"rect\")\n\t\t.data(data)\n\t\t.attr(\"y\", function (datum) {\n\t\t\treturn height - y(datum.value);\n\t\t})\n\t\t.attr(\"height\", function (datum) {\n\t\t\treturn y(datum.value);\n\t\t});\n\tvar texts = svg.selectAll(\"text.labels\")\n\t\t.data(data)\n\t\t.attr(\"y\", function (datum) {\n\t\t\treturn height - y(datum.value);\n\t\t})\n\t\t.text(function (datum) {\n\t\t\treturn datum.value.toFixed(1);\n\t\t});\n\t// enter\n\trects.enter().append(\"svg:rect\");\n\ttexts.enter().append(\"svg:text\");\n\t// exit\n\trects.exit().remove();\n\ttexts.exit().remove();\n}\n\n/******** stats ********/\nstats = new Stats();\nstats.domElement.style.position = 'absolute';\nstats.domElement.style.top = '0px';\ndocument.getElementById('container').appendChild(stats.domElement);\n\n// update stats on every iteration\ndocument.addEventListener('clmtrackrIteration', function (event) {\n\tstats.update();\n}, false);"],"sourceRoot":""}